<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Historial de Escaneos</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="presentActionSheet()">
        <ion-icon name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="search-section">
    <ion-searchbar 
      [(ngModel)]="searchTerm"
      (ionInput)="onSearchChange($event)"
      placeholder="Buscar por sitio o fecha..."
      showClearButton="focus">
    </ion-searchbar>
  </div>

  <div class="filter-section">
    <ion-segment [(ngModel)]="filterType" (ionChange)="onFilterChange()">
      <ion-segment-button value="all">
        <ion-label>Todos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="synced">
        <ion-label>Sincronizados</ion-label>
      </ion-segment-button>
      <ion-segment-button value="pending">
        <ion-label>Pendientes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="error">
        <ion-label>Errores</ion-label>
      </ion-segment-button>
    </ion-segment>
  </div>

  <div class="scans-list" *ngIf="filteredScans.length > 0">
    <ion-list lines="full">
      <ion-item *ngFor="let scan of filteredScans; trackBy: trackByScan">
        <ion-icon 
          [name]="getSyncStatusIcon(scan.syncStatus)"
          [color]="getSyncStatusColor(scan.syncStatus)"
          slot="start">
        </ion-icon>
        
        <ion-label>
          <h2>Sitio ID: {{ scan.id_sitio }}</h2>
          <h3>{{ scan.fecha | date:'dd/MM/yyyy HH:mm:ss' }}</h3>
          <p *ngIf="scan.latitud && scan.longitud">
            üìç Lat: {{ scan.latitud | number:'1.4-4' }}, Lng: {{ scan.longitud | number:'1.4-4' }}
          </p>
        </ion-label>
        
        <ion-note slot="end" [color]="getSyncStatusColor(scan.syncStatus)">
          {{ getSyncStatusText(scan.syncStatus) }}
        </ion-note>
      </ion-item>
    </ion-list>
  </div>

  <div class="no-records" *ngIf="filteredScans.length === 0">
    <ion-icon name="document-text-outline" class="no-records-icon"></ion-icon>
    <p>No hay registros para mostrar</p>
    <p class="no-records-subtitle">
      {{ searchTerm ? 'No se encontraron resultados para tu busqueda' : 
         filterType === 'all' ? 'Aun no has escaneado ningun codigo QR' : 
         'No hay registros con el filtro seleccionado' }}
    </p>
  </div>

</ion-content>